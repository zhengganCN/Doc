# Use、Run 和 Map

1. 使用 Use、Run 和 Map 配置 HTTP 管道。
   - Use 方法可使管道短路（即不调用 next 请求委托）。
   - Run 是一种约定，并且某些中间件组件可公开在管道末尾运行的 Run[Middleware] 方法。
   - Map 扩展用作约定来创建管道分支。 Map 基于给定请求路径的匹配项来创建请求管道分支。 如果请求路径以给定路径开头，则执行分支。

2. 例子

    ```C#
    public class Startup
    {
        private static void HandleMapTest1(IApplicationBuilder app)
        {
            app.Run(async context =>
            {
                await context.Response.WriteAsync("Map Test 1");
            });
        }

        private static void HandleMapTest2(IApplicationBuilder app)
        {
            app.Run(async context =>
            {
                await context.Response.WriteAsync("Map Test 2");
            });
        }

        public void Configure(IApplicationBuilder app)
        {
            app.Map("/map1", HandleMapTest1);

            app.Map("/map2", HandleMapTest2);

            app.Run(async context =>
            {
                await context.Response.WriteAsync("Hello from non-Map delegate. <p>");
            });
        }
    }
    ```

    - 下表使用前面的代码显示来自 `http://localhost:1234` 的请求和响应。
    ---------------------------------
    | 请求                | 响应                         |
    | ------------------- | ---------------------------- |
    | localhost:1234      | Hello from non-Map delegate. |
    | localhost:1234/map1 | Map Test 1                   |
    | localhost:1234/map2 | Map Test 2                   |
    | localhost:1234/map3 | Hello from non-Map delegate. |

3. 例子

    ```C#
    public class Startup
    {
        private static void HandleMapTest1(IApplicationBuilder app)
        {
            app.Run(async context =>
            {
                await context.Response.WriteAsync("Map Test 1");
            });
        }

        private static void HandleMapTest2(IApplicationBuilder app)
        {
            app.Run(async context =>
            {
                await context.Response.WriteAsync("Map Test 2");
            });
        }

        public void Configure(IApplicationBuilder app)
        {
            app.Map("/map1", HandleMapTest1);

            app.Map("/map2", HandleMapTest2);

            app.Run(async context =>
            {
                await context.Response.WriteAsync("Hello from non-Map delegate. <p>");
            });
        }
    }
    ```

    - 下表使用前面的代码显示来自 `http://localhost:1234` 的请求和响应。
    ---------------------------------
    | 请求                | 响应                         |
    | ------------------- | ---------------------------- |
    | localhost:1234      | Hello from non-Map delegate. |
    | localhost:1234/map1 | Map Test 1                   |
    | localhost:1234/map2 | Map Test 2                   |
    | localhost:1234/map3 | Hello from non-Map delegate. |
